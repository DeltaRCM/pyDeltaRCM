<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Resume model run from checkpoint &#8212; pyDeltaRCM 2.1.4 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxdoc.css?v=d59dc883" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=dc13204d"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Slightly sloping basin" href="slight_slope.html" />
    <link rel="prev" title="Basic script to run the model" href="basic_runs.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="slight_slope.html" title="Slightly sloping basin"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="basic_runs.html" title="Basic script to run the model"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyDeltaRCM 2.1.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Examples of using and working with pyDeltaRCM</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Resume model run from checkpoint</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="resume-model-run-from-checkpoint">
<h1>Resume model run from checkpoint<a class="headerlink" href="#resume-model-run-from-checkpoint" title="Link to this heading">¶</a></h1>
<p>Resuming from checkpoint can be helpful in several situations.</p>
<p>The simplest scenario is where you want to simply run the simulation for a longer amount of time.
Another common scenario is where you want to use a single checkpoint file to change conditions in two new “child” runs, and then continue each of these runs.</p>
<p>Here, we include three examples for resuming from checkpoints.</p>
<section id="continuing-a-run-for-more-time">
<h2>Continuing a run for more time<a class="headerlink" href="#continuing-a-run-for-more-time" title="Link to this heading">¶</a></h2>
<p>Create a new model run, run it for two timesteps, then finalize model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">delta1</span> <span class="o">=</span> <span class="n">pyDeltaRCM</span><span class="o">.</span><span class="n">DeltaModel</span><span class="p">(</span>
    <span class="n">out_dir</span><span class="o">=</span><span class="s1">&#39;checkpoint_example&#39;</span><span class="p">,</span>
    <span class="n">save_checkpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">checkpoint_dt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">delta1</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

<span class="n">delta1</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>

<span class="n">two_timesteps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">delta1</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We set <cite>checkpoint_dt</cite> to <code class="docutils literal notranslate"><span class="pre">1</span></code> so that a checkpoint is saved on every iteration (since we only run two iterations); you probably want to use a small multiple of <cite>dt</cite>.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">two_timesteps</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;bed elevation after two timesteps&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="../_downloads/eca1a7b0951880a87365cfcdba684c70/resume_from_checkpoint-2.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/bb61d02a9391c9a8d64b8576bc05a809/resume_from_checkpoint-2.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>)</p>
<figure class="align-default">
<img alt="../_images/resume_from_checkpoint-2.png" class="plot-directive" src="../_images/resume_from_checkpoint-2.png" />
</figure>
<p>Now, some time later (days, months, etc), we want to run the model for some additional timesteps.
We simply specify the output folder that contains the model and the checkpoint file, and set <cite>resume_checkpoint</cite> to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">delta2</span> <span class="o">=</span> <span class="n">pyDeltaRCM</span><span class="o">.</span><span class="n">DeltaModel</span><span class="p">(</span>
    <span class="n">out_dir</span><span class="o">=</span><span class="s1">&#39;checkpoint_example&#39;</span><span class="p">,</span>
    <span class="n">resume_checkpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">delta2</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

<span class="n">delta2</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>

<span class="n">four_timesteps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">delta2</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">four_timesteps</span> <span class="o">-</span> <span class="n">two_timesteps</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">diff</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;bed elevation change after two additional timesteps&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="../_downloads/978102fccb25a97d88a8534282a00cec/resume_from_checkpoint-3.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/9f397b5c6646d82c3095c92039ab6579/resume_from_checkpoint-3.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>)</p>
<figure class="align-default">
<img alt="../_images/resume_from_checkpoint-3.png" class="plot-directive" src="../_images/resume_from_checkpoint-3.png" />
</figure>
</section>
<section id="continuing-a-run-for-more-time-from-any-file">
<h2>Continuing a run for more time from any file<a class="headerlink" href="#continuing-a-run-for-more-time-from-any-file" title="Link to this heading">¶</a></h2>
<p>In this example, we will run from a checkpoint file that is shipped with pyDeltaRCM.
Referencing the documentation for the <code class="xref py py-obj docutils literal notranslate"><span class="pre">resume_checkpoint</span></code> parameter, it is clear that we can specify a checkpoint file by passing a pyDeltaRCM output folder as a string.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">delta</span> <span class="o">=</span> <span class="n">pyDeltaRCM</span><span class="o">.</span><span class="n">DeltaModel</span><span class="p">(</span>
    <span class="n">resume_checkpoint</span><span class="o">=</span><span class="s1">&#39;/path/to/out_dir&#39;</span><span class="p">)</span>
<span class="n">before</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">delta</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<span class="n">after</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span>

<span class="c1"># set up axis</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">after</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">after</span> <span class="o">-</span> <span class="n">before</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="../_downloads/fbfba885573f1f8073329b4dbf3b5549/resume_from_checkpoint-5.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/13c8f1347a44cff8883d9c2b76c9512f/resume_from_checkpoint-5.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>)</p>
<figure class="align-default">
<img alt="../_images/resume_from_checkpoint-5.png" class="plot-directive" src="../_images/resume_from_checkpoint-5.png" />
</figure>
</section>
<section id="continuing-multiple-runs-from-any-file-with-preprocessor">
<h2>Continuing multiple runs from any file with Preprocessor<a class="headerlink" href="#continuing-multiple-runs-from-any-file-with-preprocessor" title="Link to this heading">¶</a></h2>
<p>Here, we set up three jobs which have different <cite>f_bedload</cite> values, while resuming from the checkpoint file shipped with pyDeltaRCM.</p>
<p>We use the <cite>Preprocessor</cite> to execute the model runs in this example.
But you could access <code class="docutils literal notranslate"><span class="pre">pp.file_list</span></code> to get the list of yaml configuration files generated and use these manually with the low-level API, if needed.
This approach would not be a best-practice though, since you can easily pass a custom class to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">run_jobs</span></code> method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up dictionary for parameters and create a `Preprocessor`</span>
<span class="n">param_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">resume_checkpoint</span><span class="o">=</span><span class="s1">&#39;/path/to/out_dir&#39;</span><span class="p">,</span>
    <span class="n">matrix</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;f_bedload&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]},</span>
    <span class="n">timesteps</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>

    <span class="c1"># let the preprocessor set up the jobs for you from checkpoint</span>
<span class="n">pp</span> <span class="o">=</span> <span class="n">pyDeltaRCM</span><span class="o">.</span><span class="n">Preprocessor</span><span class="p">(</span>
    <span class="n">param_dict</span><span class="p">)</span>

<span class="c1"># run the jobs</span>
<span class="c1">#   note: timesteps=0 here, but should be changed to run your jobs!</span>
<span class="n">pp</span><span class="o">.</span><span class="n">run_jobs</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We set <cite>timesteps=0</cite> above, so that no timesteps are actually run in the documentation! You need to change this to run the jobs!</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">job_list</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">job_list</span><span class="p">)):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">job_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">deltamodel</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">job_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">deltamodel</span><span class="o">.</span><span class="n">f_bedload</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="../_downloads/7c7c0d12b5c486d1482543b9e34a34db/resume_from_checkpoint-7.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/98a408e7b6c68fa4ec9228c2fd546afc/resume_from_checkpoint-7.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>)</p>
<figure class="align-default">
<img alt="../_images/resume_from_checkpoint-7.png" class="plot-directive" src="../_images/resume_from_checkpoint-7.png" />
</figure>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>You can pass a custom class to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">run_jobs</span></code> method. This can add custom behavior during instantiation or runtime via hooks, and let’s you use the Preprocessor to set up multiple jobs!</p>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Resume model run from checkpoint</a><ul>
<li><a class="reference internal" href="#continuing-a-run-for-more-time">Continuing a run for more time</a></li>
<li><a class="reference internal" href="#continuing-a-run-for-more-time-from-any-file">Continuing a run for more time from any file</a></li>
<li><a class="reference internal" href="#continuing-multiple-runs-from-any-file-with-preprocessor">Continuing multiple runs from any file with Preprocessor</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="basic_runs.html"
                          title="previous chapter">Basic script to run the model</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="slight_slope.html"
                          title="next chapter">Slightly sloping basin</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/examples/resume_from_checkpoint.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="slight_slope.html" title="Slightly sloping basin"
             >next</a> |</li>
        <li class="right" >
          <a href="basic_runs.html" title="Basic script to run the model"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyDeltaRCM 2.1.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Examples of using and working with pyDeltaRCM</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Resume model run from checkpoint</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2020, The DeltaRCM Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>