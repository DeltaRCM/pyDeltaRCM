
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Time-varying bedload &#8212; pyDeltaRCM 1.3.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxdoc.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Time-varying inlet velocity" href="variable_velocity.html" />
    <link rel="prev" title="Constraining subsidence to part of the domain" href="subsidence_region.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="variable_velocity.html" title="Time-varying inlet velocity"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="subsidence_region.html" title="Constraining subsidence to part of the domain"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyDeltaRCM 1.3.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Examples of using and working with pyDeltaRCM</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Time-varying bedload</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="time-varying-bedload">
<h1>Time-varying bedload<a class="headerlink" href="#time-varying-bedload" title="Permalink to this headline">¶</a></h1>
<p>The following example demonstrates how to configure a subclassing model with a time-varying parameter.
In this example, the time-varying behavior arises by managing two “switches”, <code class="docutils literal notranslate"><span class="pre">self._changed</span></code> and <code class="docutils literal notranslate"><span class="pre">self._changed_back</span></code>, which change the state of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">f_bedload</span></code> parameters at a predetermined time in the mode sequence.</p>
<p>The following codes produce two runs (using <cite>matrix</cite> expansion from the Preprocessor), which has a baseline <cite>f_bedload</cite> value of either <code class="docutils literal notranslate"><span class="pre">0.3</span></code> or <code class="docutils literal notranslate"><span class="pre">0.7</span></code>, and for a period in the middle of the run, the <cite>f_bedload</cite> values are mirrored by <code class="docutils literal notranslate"><span class="pre">self.f_bedload</span> <span class="pre">=</span> <span class="pre">(1</span> <span class="pre">-</span> <span class="pre">self.f_bedload)</span></code>, i.e., briefly switching the bedload values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">VariableBedloadModel</span><span class="p">(</span><span class="n">pyDeltaRCM</span><span class="o">.</span><span class="n">DeltaModel</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_changed_back</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">hook_solve_water_and_sediment_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change the state depending on the _time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if the state has been changed, and time to change it</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_changed</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">&gt;</span> <span class="mi">459909090</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f_bedload</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_bedload</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_changed</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">_msg</span> <span class="o">=</span> <span class="s1">&#39;Bedload changed to </span><span class="si">{f_bedload}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">f_bedload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_bedload</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">_msg</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># check if the state has been changed back, and time to change it back</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_changed_back</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">&gt;</span> <span class="mi">714545454</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f_bedload</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_bedload</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_changed_back</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">_msg</span> <span class="o">=</span> <span class="s1">&#39;Bedload changed back to </span><span class="si">{f_bedload}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">f_bedload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_bedload</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">_msg</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Checking on the state-change effect</p>
<p>To demonstrate how this works, let’s loop through time and check the model state.
Here, we will change the model time value directly, so that we can verify that the model is working as intended, but you should never do this in practice.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mdl_muddy</span> <span class="o">=</span> <span class="n">VariableBedloadModel</span><span class="p">(</span><span class="n">f_bedload</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                                 <span class="n">out_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">)</span>
<span class="n">mdl_sandy</span> <span class="o">=</span> <span class="n">VariableBedloadModel</span><span class="p">(</span><span class="n">f_bedload</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You should never modify the model time via <code class="docutils literal notranslate"><span class="pre">self._time</span></code> directly when working with the model.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># set the &quot;simulation&quot; range</span>
<span class="n">_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">fb_mdl_muddy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">_times</span><span class="p">)</span>
<span class="n">fb_mdl_sandy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">_times</span><span class="p">)</span>

<span class="c1"># loop through time, change the model time and grab f_bedload values</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_times</span><span class="p">):</span>
    <span class="c1"># change the model time directly</span>
    <span class="n">mdl_muddy</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">_time</span>  <span class="c1"># you should never do this</span>
    <span class="n">mdl_sandy</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">_time</span>  <span class="c1"># you should never do this</span>

    <span class="c1"># run the hooked method</span>
    <span class="n">mdl_muddy</span><span class="o">.</span><span class="n">hook_solve_water_and_sediment_timestep</span><span class="p">()</span>
    <span class="n">mdl_sandy</span><span class="o">.</span><span class="n">hook_solve_water_and_sediment_timestep</span><span class="p">()</span>

    <span class="c1"># grab the state of the `f_bedload` parameter</span>
    <span class="n">fb_mdl_muddy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdl_muddy</span><span class="o">.</span><span class="n">f_bedload</span>  <span class="c1"># get the value</span>
    <span class="n">fb_mdl_sandy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdl_sandy</span><span class="o">.</span><span class="n">f_bedload</span>  <span class="c1"># get the value</span>

<span class="c1"># add it to the plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">_times</span><span class="p">,</span> <span class="n">fb_mdl_muddy</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;saddlebrown&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;muddy&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">_times</span><span class="p">,</span> <span class="n">fb_mdl_sandy</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;goldenrod&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;sandy&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># clean up</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;f_bedload&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;model time (s)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../examples/variable_bedload-3.png">png</a>, <a class="reference external" href="../examples/variable_bedload-3.hires.png">hires.png</a>)</p>
<figure class="align-default">
<img alt="../_images/variable_bedload-3.png" class="plot-directive" src="../_images/variable_bedload-3.png" />
</figure>
<p class="rubric">Running the model for real</p>
<p>Given a yaml file (<code class="docutils literal notranslate"><span class="pre">variable_bedload.yaml</span></code>):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Length</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5000.</span>
<span class="nt">Width</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10000.</span>
<span class="nt">dx</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">50</span>
<span class="nt">N0_meters</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">500</span>
<span class="nt">C0_percent</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.05</span>
<span class="nt">SLR</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.5e-8</span>
<span class="nt">h0</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">u0</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.1</span>
<span class="nt">coeff_U_dep_mud</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="nt">parallel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

<span class="nt">matrix</span><span class="p">:</span>
  <span class="nt">f_bedload</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">0.3</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">0.7</span>
</pre></div>
</div>
<p>and a script to run the code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="c1"># base yaml configuration</span>
    <span class="n">base_yaml</span> <span class="o">=</span> <span class="s1">&#39;variable_bedload.yaml&#39;</span>

    <span class="n">pp</span> <span class="o">=</span> <span class="n">pyDeltaRCM</span><span class="o">.</span><span class="n">Preprocessor</span><span class="p">(</span>
            <span class="n">base_yaml</span><span class="p">,</span>
            <span class="n">timesteps</span><span class="o">=</span><span class="mi">12000</span><span class="p">)</span>

    <span class="c1"># run the jobs</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">run_jobs</span><span class="p">(</span><span class="n">DeltaModel</span><span class="o">=</span><span class="n">VariableBedloadModel</span><span class="p">)</span>
</pre></div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="subsidence_region.html"
                        title="previous chapter">Constraining subsidence to part of the domain</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="variable_velocity.html"
                        title="next chapter">Time-varying inlet velocity</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/examples/variable_bedload.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="variable_velocity.html" title="Time-varying inlet velocity"
             >next</a> |</li>
        <li class="right" >
          <a href="subsidence_region.html" title="Constraining subsidence to part of the domain"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyDeltaRCM 1.3.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Examples of using and working with pyDeltaRCM</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Time-varying bedload</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, The DeltaRCM Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.2.
    </div>
  </body>
</html>