
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>water_tools &#8212; pyDeltaRCM 1.2.0 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="pyDeltaRCM.water_tools.water_tools" href="../../_autosummary/pyDeltaRCM.water_tools.water_tools.html" />
    <link rel="prev" title="pyDeltaRCM.init_tools.init_tools" href="../../_autosummary/pyDeltaRCM.init_tools.init_tools.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../_autosummary/pyDeltaRCM.water_tools.water_tools.html" title="pyDeltaRCM.water_tools.water_tools"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../../_autosummary/pyDeltaRCM.init_tools.init_tools.html" title="pyDeltaRCM.init_tools.init_tools"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pyDeltaRCM 1.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">API reference</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">water_tools</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="water-tools">
<h1>water_tools<a class="headerlink" href="#water-tools" title="Permalink to this headline">¶</a></h1>
<p>The tools are defined in <code class="docutils literal notranslate"><span class="pre">pyDeltaRCM.water_tools</span></code>.</p>
<div class="section" id="public-api-methods-attached-to-model">
<h2>Public API methods attached to model<a class="headerlink" href="#public-api-methods-attached-to-model" title="Permalink to this headline">¶</a></h2>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../../_autosummary/pyDeltaRCM.water_tools.water_tools.html#pyDeltaRCM.water_tools.water_tools" title="pyDeltaRCM.water_tools.water_tools"><code class="xref py py-obj docutils literal notranslate"><span class="pre">water_tools</span></code></a>()</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="water-tools-helper-functions">
<h2>water_tools helper functions<a class="headerlink" href="#water-tools-helper-functions" title="Permalink to this headline">¶</a></h2>
<p>Note that these routines are jitted for speed. They generally take a large
number of arrays and constants and return a new array(s) to continue with the
model progression.</p>
<dl class="py function">
<dt id="pyDeltaRCM.water_tools._get_weight_at_cell_water">
<code class="sig-prename descclassname"><span class="pre">pyDeltaRCM.water_tools.</span></code><code class="sig-name descname"><span class="pre">_get_weight_at_cell_water</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_sfc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth_nbrs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ct_nbrs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dry_depth</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">theta</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyDeltaRCM.water_tools._get_weight_at_cell_water" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="pyDeltaRCM.water_tools._choose_next_directions">
<code class="sig-prename descclassname"><span class="pre">pyDeltaRCM.water_tools.</span></code><code class="sig-name descname"><span class="pre">_choose_next_directions</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_weights</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyDeltaRCM.water_tools._choose_next_directions" title="Permalink to this definition">¶</a></dt>
<dd><p>Get new cell locations, based on water weights.</p>
<dl class="simple">
<dt>Algorithm is to:</dt><dd><ol class="arabic simple">
<li><p>loop through each parcel, which is described by a pair in the
<cite>inds</cite> array.</p></li>
<li><p>determine the water weights for that location (from <cite>water_weights</cite>)</p></li>
<li><p>choose a new cell based on the probabilities of the weights (using
the <cite>random_pick</cite> function)</p></li>
</ol>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inds</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">ndarray</span></code>) – Current unraveled indices of the parcels. <code class="docutils literal notranslate"><span class="pre">(N,)</span></code>  <cite>ndarray</cite>
containing the unraveled indices.</p></li>
<li><p><strong>water_weights</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">ndarray</span></code>) – Weights of every water cell. <code class="docutils literal notranslate"><span class="pre">(LxW,</span> <span class="pre">9)</span></code> <cite>ndarray</cite>, uses unraveled
indicies along 0th dimension; 9 cells represent self and 8 neighboring
cells.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>next_direction</strong> – The direction to move towards the new cell for water parcels, relative
to the current location. I.e., this is the D8 direction the parcel is
going to travel in the next stage,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">pyDeltaRCM.shared_tools._calculate_new_ind</span></code>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pyDeltaRCM.water_tools._calculate_new_inds">
<code class="sig-prename descclassname"><span class="pre">pyDeltaRCM.water_tools.</span></code><code class="sig-name descname"><span class="pre">_calculate_new_inds</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">current_inds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_direction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ravel_walk</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyDeltaRCM.water_tools._calculate_new_inds" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the new location (current_inds) of parcels.</p>
<p>Use the information of the current parcel (<cite>current_inds</cite>) in conjunction
with the D8 direction the parcel needs to travel (<cite>new_direction</cite>) to
determine the new current_inds of each parcel.</p>
<p>In implementation, we use the flattened <cite>ravel_walk</cite> array, but the result
is identical to unraveling the index, adding <cite>iwalk</cite> and <cite>jwalk</cite> to the
location and then raveling the index back.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ind_tuple</span> <span class="o">=</span> <span class="n">shared_tools</span><span class="o">.</span><span class="n">custom_unravel</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">domain_shape</span><span class="p">)</span>
<span class="n">new_ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">ind_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">jwalk</span><span class="p">[</span><span class="n">newd</span><span class="p">],</span>
           <span class="n">ind_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">iwalk</span><span class="p">[</span><span class="n">newd</span><span class="p">])</span>
<span class="n">new_inds</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">shared_tools</span><span class="o">.</span><span class="n">custom_ravel</span><span class="p">(</span><span class="n">new_ind</span><span class="p">,</span> <span class="n">domain_shape</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="pyDeltaRCM.water_tools._check_for_loops">
<code class="sig-prename descclassname"><span class="pre">pyDeltaRCM.water_tools.</span></code><code class="sig-name descname"><span class="pre">_check_for_loops</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">free_surf_walk_inds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_inds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">CTR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stage_above_SL</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyDeltaRCM.water_tools._check_for_loops" title="Permalink to this definition">¶</a></dt>
<dd><p>Check for loops in water parcel pathways.</p>
<p>Look for looping random walks. I.e., this function checks for where a
parcel will return on its <code class="xref py py-obj docutils literal notranslate"><span class="pre">new_inds</span></code> to somewhere it has already been
in <code class="xref py py-obj docutils literal notranslate"><span class="pre">free_surf_walk_inds</span></code>. If the loop is found, the parcel is
relocated along the mean transport vector of the parcel, which is computed
as the vector from the cell <cite>(0, CTR)</cite> to the new location in <cite>new_inds</cite>.</p>
<p>This implementation of loop checking will relocate any parcel that has
looped, but only disqualifies a parcel <cite>p</cite> from contributing to the free
surface in <code class="xref py py-obj docutils literal notranslate"><span class="pre">_accumulate_free_surf_walks</span></code> (i.e., <cite>looped[p] == 1</cite>) if
the stage at the looped location is above the sea level in the domain.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>free_surf_walk_inds</strong> – Array recording the walk of parcels. Shape is <cite>(:obj:`Np_water</cite>,
…)`, where the second dimension will depend on the step number, but
records each step of the parcel. Each element in the array records the
<em>flat</em> index into the domain.</p></li>
<li><p><strong>new_inds</strong> – Array recording the new index for each water parcel, if the step is
taken. Shape is <cite>(:obj:`Np_water</cite>, 1)`, with each element recording
the <em>flat</em> index into the domain shape.</p></li>
<li><p><strong>_step</strong> – Step number of water parcels.</p></li>
<li><p><strong>L0</strong> – Domain shape parameter, number of cells inlet length.</p></li>
<li><p><strong>CTR</strong> – Domain shape parameter, index along inlet wall making the center of
the domain. I.e., <cite>(0, CTR)</cite> is the midpoint across the inlet, along
the inlet domain edge.</p></li>
<li><p><strong>stage_above_SL</strong> – Water surface elevation minuns the domain sea level.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>new_inds</em> – An updated array of parcel indicies, where the index of a parcel has
been changed, if and only if, that parcel was looped.</p></li>
<li><p><em>looped</em> – A binary integer array indicating whether a parcel was determined to
have been looped, and should be disqualified from the free surface
computation.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pyDeltaRCM.water_tools._update_dirQfield">
<code class="sig-prename descclassname"><span class="pre">pyDeltaRCM.water_tools.</span></code><code class="sig-name descname"><span class="pre">_update_dirQfield</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">qfield</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">astep</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dirstep</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyDeltaRCM.water_tools._update_dirQfield" title="Permalink to this definition">¶</a></dt>
<dd><p>Update unit vector of water flux in x or y.</p>
</dd></dl>

<dl class="py function">
<dt id="pyDeltaRCM.water_tools._update_absQfield">
<code class="sig-prename descclassname"><span class="pre">pyDeltaRCM.water_tools.</span></code><code class="sig-name descname"><span class="pre">_update_absQfield</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">qfield</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">astep</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Qp_water</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyDeltaRCM.water_tools._update_absQfield" title="Permalink to this definition">¶</a></dt>
<dd><p>Update norm of water flux vector.</p>
</dd></dl>

<dl class="py function">
<dt id="pyDeltaRCM.water_tools._accumulate_free_surface_walks">
<code class="sig-prename descclassname"><span class="pre">pyDeltaRCM.water_tools.</span></code><code class="sig-name descname"><span class="pre">_accumulate_free_surface_walks</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">free_surf_walk_inds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">free_surf_flag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ux</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">u0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H_SL</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">S0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyDeltaRCM.water_tools._accumulate_free_surface_walks" title="Permalink to this definition">¶</a></dt>
<dd><p>Accumulate the free surface by walking parcel paths.</p>
<p>This routine comprises the hydrodynamic physics-based computations.</p>
<dl>
<dt>Algorithm is to:</dt><dd><ol class="arabic simple">
<li><p>loop through every parcel’s directed random walk in series.</p></li>
</ol>
<p>2. for a parcel’s walk, unravel the indices and determine whether the
parcel should contribute to the free surface. Parcels are considered
contributors if they have reached the ocean and if they are not looped
pathways.</p>
<p>3. then, we begin at the downstream end of the parcel’s walk and
iterate up-walk until, determining the <cite>Hnew</cite> for each location.
Downstream of the shoreline-ocean boundary, the water surface
elevation is set to the sea level. Upstream of the shoreline-ocean
boundary, the water surface is determined according to the land-slope
(<code class="xref py py-obj docutils literal notranslate"><span class="pre">S0</span></code>) and the parcel pathway.</p>
<ol class="arabic simple" start="4">
<li><p>repeat from 2, for each parcel.</p></li>
</ol>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pyDeltaRCM.water_tools._smooth_free_surface">
<code class="sig-prename descclassname"><span class="pre">pyDeltaRCM.water_tools.</span></code><code class="sig-name descname"><span class="pre">_smooth_free_surface</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Hin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Nsmooth</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Csmooth</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyDeltaRCM.water_tools._smooth_free_surface" title="Permalink to this definition">¶</a></dt>
<dd><p>Smooth the free surface.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Hin</strong> – Stage input to the smoothing (i.e., the old stage).</p></li>
<li><p><strong>cell_type</strong> – Type of each cell.</p></li>
<li><p><strong>Nsmooth</strong> – Number of times to smooth the free surface (i.e., stage)</p></li>
<li><p><strong>Csmooth</strong> – Underrelaxation coefficient for smoothing iterations.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">water_tools</a><ul>
<li><a class="reference internal" href="#public-api-methods-attached-to-model">Public API methods attached to model</a></li>
<li><a class="reference internal" href="#water-tools-helper-functions">water_tools helper functions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../../_autosummary/pyDeltaRCM.init_tools.init_tools.html"
                        title="previous chapter">pyDeltaRCM.init_tools.init_tools</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../../_autosummary/pyDeltaRCM.water_tools.water_tools.html"
                        title="next chapter">pyDeltaRCM.water_tools.water_tools</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/reference/water_tools/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../_autosummary/pyDeltaRCM.water_tools.water_tools.html" title="pyDeltaRCM.water_tools.water_tools"
             >next</a> |</li>
        <li class="right" >
          <a href="../../_autosummary/pyDeltaRCM.init_tools.init_tools.html" title="pyDeltaRCM.init_tools.init_tools"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pyDeltaRCM 1.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >API reference</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">water_tools</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, The DeltaRCM Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.2.
    </div>
  </body>
</html>